[SERVICE]
    Flush        1
    Daemon       Off
    Log_Level    info
    Parsers_File parsers.conf

# CPU Metrics - collect CPU usage statistics
[INPUT]
    Name          cpu
    Tag           metrics.cpu
    Interval_Sec  1

# Memory Metrics - collect memory usage statistics  
[INPUT]
    Name          mem
    Tag           metrics.memory
    Interval_Sec  1

# Disk I/O Metrics
[INPUT]
    Name          disk
    Tag           metrics.disk
    Interval_Sec  2

# Network I/O Metrics
[INPUT]
    Name          netif
    Tag           metrics.network
    Interval_Sec  2
    Interface     eth0

# System Logs - tail system logs if available
[INPUT]
    Name          tail
    Tag           logs.system
    Path          /var/log/syslog
    Path_Key      filepath
    Read_from_Head false
    Skip_Long_Lines On
    Refresh_Interval 5

# Generate dummy complex JSON data for testing
[INPUT]
    Name          dummy
    Tag           logs.application
    Dummy         {"timestamp":"2025-11-21T10:45:00Z","level":"info","service":"web-api","host":"server-01","request_id":"req-12345","method":"POST","path":"/api/users","status":200,"duration_ms":45,"user_id":"user-789","ip":"192.168.1.100","user_agent":"Mozilla/5.0","response_size":1024,"tags":["production","api","success"],"metadata":{"region":"us-west-2","datacenter":"dc1","version":"v2.3.1"}}
    Rate          2

# Generate error logs
[INPUT]
    Name          dummy
    Tag           logs.errors
    Dummy         {"timestamp":"2025-11-21T10:45:00Z","level":"error","service":"payment-service","host":"server-02","error_code":"PAYMENT_FAILED","error_message":"Transaction declined by bank","transaction_id":"txn-98765","amount":150.50,"currency":"USD","user_id":"user-456","retry_count":3,"stack_trace":"at processPayment (payment.js:123)\\nat handleRequest (server.js:456)","tags":["production","payment","failure"]}
    Rate          1

# OpenTelemetry HTTP input for receiving OTLP traces
[INPUT]
    Name          opentelemetry
    Tag           traces.app
    Listen        0.0.0.0
    Port          4318
    Buffer_Size   65536

# Add metadata to all records
[FILTER]
    Name          record_modifier
    Match         *
    Record        environment production
    Record        cluster main-cluster
    Record        fluent_bit_version 4.2.1

# Add hostname to all records
[FILTER]
    Name          modify
    Match         *
    Add           hostname ${HOSTNAME}

# Parse and enrich CPU metrics
[FILTER]
    Name          nest
    Match         metrics.cpu
    Operation     nest
    Wildcard      cpu*
    Nest_under    cpu_stats

# Parse and enrich memory metrics
[FILTER]
    Name          nest
    Match         metrics.memory
    Operation     nest
    Wildcard      Mem.*
    Nest_under    memory_stats

# Add custom tags based on log level
[FILTER]
    Name          lua
    Match         logs.*
    script        /fluent-bit/etc/enrich.lua
    call          enrich_logs

# Transform CPU metrics to proper metrics format
[FILTER]
    Name          modify
    Match         metrics.cpu
    Add           metric_type gauge
    Add           metric_name cpu_usage
    Add           unit percent

# Transform Memory metrics to proper metrics format
[FILTER]
    Name          modify
    Match         metrics.memory
    Add           metric_type gauge
    Add           metric_name memory_usage
    Add           unit bytes

# Transform Disk metrics to proper metrics format
[FILTER]
    Name          modify
    Match         metrics.disk
    Add           metric_type counter
    Add           metric_name disk_io
    Add           unit bytes

# Transform Network metrics to proper metrics format
[FILTER]
    Name          modify
    Match         metrics.network
    Add           metric_type counter
    Add           metric_name network_io
    Add           unit bytes

# Output all metrics to unified Parseable metrics stream
[OUTPUT]
    Name          parseable
    Match         metrics.*
    Host          100.118.176.76
    Port          8010
    TLS           Off
    Stream        otel-metrics
    data_type     metrics
    log_source    otel-metrics
    auth_header   Basic YWRtaW46YWRtaW4=
    compress      gzip
    Retry_Limit   3

# Output Application logs to Parseable
[OUTPUT]
    Name          parseable
    Match         logs.application
    Host          anton
    Port          8010
    TLS           Off
    Stream        application-logs
    data_type     logs
    log_source    otel-logs
    auth_header   Basic YWRtaW46YWRtaW4=
    compress      gzip
    Retry_Limit   3

# Output Error logs to Parseable (separate stream)
[OUTPUT]
    Name          parseable
    Match         logs.errors
    Host          anton
    Port          8010
    TLS           Off
    Stream        error-logs
    data_type     logs
    log_source    otel-logs
    auth_header   Basic YWRtaW46YWRtaW4=
    compress      gzip
    Retry_Limit   3

# Output System logs to Parseable
[OUTPUT]
    Name          parseable
    Match         logs.system
    Host          anton
    Port          8010
    TLS           Off
    Stream        system-logs
    data_type     logs
    log_source    otel-logs
    auth_header   Basic YWRtaW46YWRtaW4=
    compress      gzip
    Retry_Limit   3

# Output Traces to Parseable via OpenTelemetry plugin (disabled - no trace input)
# Uncomment when using actual OTLP trace source
#[OUTPUT]
   Name          opentelemetry
   Match         traces.*
   Host          anton
   Port          8010
   Traces_uri    /v1/traces
   Log_response_payload True
   Tls           Off
   Http_User     admin
   Http_Passwd   admin
   Header        X-P-Stream oteltraces
   Header        X-P-Log-Source otel-traces
   compress      gzip
   Retry_Limit   3

# Also output everything to stdout for debugging
[OUTPUT]
    Name          stdout
    Match         *
    Format        json_lines

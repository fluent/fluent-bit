# Test configuration for Kubernetes autodiscovery feature
# This simulates the Lua filter adding _parseable_dataset to records

[SERVICE]
    Flush        2
    Daemon       Off
    Log_Level    debug
    Parsers_File parsers.conf
    Plugins_File plugins.conf
    HTTP_Server  On
    HTTP_Listen  0.0.0.0
    HTTP_Port    2020

# Dummy input that generates test logs
[INPUT]
    Name          dummy
    Tag           test.logs
    Dummy         {"message": "Test log from app1", "_parseable_dataset": "app1-logs", "environment": "production", "service": "app1"}
    Rate          1

# Another dummy input with different stream
[INPUT]
    Name          dummy
    Tag           test.logs2
    Dummy         {"message": "Test log from app2", "_parseable_dataset": "app2-logs", "environment": "staging", "service": "app2"}
    Rate          1

# Simulate rewrite_tag output (parseable.<stream>)
[INPUT]
    Name          dummy
    Tag           parseable.frontend-logs
    Dummy         {"message": "Frontend log", "environment": "production", "service": "frontend"}
    Rate          1

# Output to Parseable with dynamic stream enabled
[OUTPUT]
    Name          parseable
    Match         *
    Host          anton
    Port          8010
    TLS           Off
    Stream        default-stream
    log_source    otel-logs
    auth_header   Basic YWRtaW46YWRtaW4=
    compress      gzip
    dynamic_stream On
    Retry_Limit   3

# Also output to stdout for debugging
[OUTPUT]
    Name          stdout
    Match         *
    Format        json_lines
